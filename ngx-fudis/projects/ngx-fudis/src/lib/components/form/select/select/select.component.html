<div class="fudis-select fudis-input-size__{{ size }}" #selectRef>
	<fudis-label
		[text]="label"
		[id]="id + '-label'"
		[requiredText]="_required ? _requiredText : undefined"
		[tooltip]="tooltip"
		[tooltipPosition]="tooltipPosition"
		[tooltipToggle]="tooltipToggle">
	</fudis-label>
	<div #inputWrapperRef class="fudis-select__input-wrapper" (click)="_clickInput($event)">
		<div
			*ngIf="!autocomplete"
			#inputRef
			tabindex="0"
			class="fudis-select__input fudis-select__input__dropdown"
			[class.fudis-form-input--disabled]="disabled"
			[class.fudis-form-input--invalid]="(control.touched && control.invalid) || (control.touched && invalidState)"
			[class.fudis-select__input--invalid]="(control.touched && control.invalid) || invalidState"
			role="combobox"
			aria-haspopup="listbox"
			(focus)="_inputFocus()"
			(blur)="_inputBlur($event)"
			(keydown)="_dropdownKeypress($event, '.fudis-select-option__focusable')"
			[attr.aria-autocomplete]="'none'"
			[attr.aria-expanded]="_dropdownOpen"
			[attr.aria-disabled]="disabled"
			[attr.required]="_required ? true : null"
			[attr.aria-labelledby]="id + '-label'"
			[attr.aria-describedby]="id + '_guidance'"
			[attr.aria-invalid]="(control.touched && control.invalid) || (control.touched && invalidState) ? true : null">
			<span *ngIf="!dropdownSelectionLabelText" class="fudis-select__input__placeholder">{{ placeholder }}</span>
			<span *ngIf="dropdownSelectionLabelText" class="fudis-select__input__label">{{
				dropdownSelectionLabelText
			}}</span>
		</div>
		<input
			type="text"
			*ngIf="autocomplete"
			#inputRef
			class="fudis-select__input fudis-select__input__autocomplete"
			[class.fudis-form-input--disabled]="disabled"
			[class.fudis-form-input--invalid]="(control.touched && control.invalid) || (control.touched && invalidState)"
			[class.fudis-select__input--invalid]="(control.touched && control.invalid) || invalidState"
			role="combobox"
			aria-haspopup="listbox"
			(focus)="_inputFocus()"
			(blur)="_inputBlur($event); _setInputValueOnBlur()"
			(keyup)="_autocompleteSelectKeypress($event)"
			[attr.aria-autocomplete]="'none'"
			[attr.aria-disabled]="disabled"
			[attr.placeholder]="placeholder"
			[attr.required]="_required ? true : null"
			[attr.aria-labelledby]="id + '-label'"
			[attr.aria-describedby]="id + '_guidance'"
			[attr.aria-invalid]="(control.touched && control.invalid) || (control.touched && invalidState) ? true : null" />

		<fudis-icon
			*ngIf="!autocomplete || (autocomplete && !autocompleteClearButton)"
			class="fudis-select__input-wrapper__icon"
			[icon]="'chevron'"
			[rotate]="_dropdownOpen ? 'cw-90' : 'ccw-90'" />
		<ng-container *ngIf="autocomplete">
			<fudis-button
				#clearFilterButton
				*ngIf="autocompleteClearButton"
				class="fudis-select__input-wrapper__icon"
				[class.fudis-select__input-wrapper__icon--hidden]="!_autocompleteFilterText()"
				(click)="_clearAutocompleteFilterText(true)"
				[size]="'icon-only'"
				[variant]="'tertiary'"
				[icon]="'close'"
				[iconRotate]="_dropdownOpen ? 'ccw-90' : 'cw-90'"
				[label]="_clearFilterText"
				[labelHidden]="true" />

			<fudis-icon
				*ngIf="!_autocompleteFilterText() && autocompleteClearButton"
				class="fudis-select__input-wrapper__icon"
				[icon]="'search'"
				[class.fudis-select__input-wrapper__icon-button--disabled]="control.disabled" />
		</ng-container>
	</div>
	<fudis-select-dropdown *ngIf="_openedOnce" #dropdownRef [open]="_dropdownOpen" [size]="size">
		<ng-container *ngIf="_content?.type === 'select-options'">
			<ng-container *ngTemplateOutlet="_content!.templateRef"></ng-container>
		</ng-container>
		<fudis-body-text
			class="fudis-select-dropdown__no-results"
			[class.fudis-select-dropdown__no-results--visible]="_visibleOptionsValues.length === 0"
			[size]="'md-light'"
			>{{ _noResultsFound }}</fudis-body-text
		>
	</fudis-select-dropdown>
	<fudis-guidance
		*ngIf="!disableGuidance"
		[inputLabel]="label"
		[helpText]="helpText"
		[for]="id"
		[errorMsg]="errorMsg"
		[control]="control" />
</div>
